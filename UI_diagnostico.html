<div class="container mt-4 mb-5" style="max-width: 1000px;">
  <header class="mb-5 text-center">
    <h1 class="text-3xl font-bold text-slate-800">Ficha de Diagnóstico Capilar</h1>
    <p class="text-slate-500">Registro profesional de servicios y color</p>
  </header>

  <form id="diagnosticoForm">
    
    <div class="card mb-4 shadow-sm border-0">
      <div class="card-header bg-slate-700 text-white font-bold small">DATOS DEL CLIENTE Y VISITA</div>
      <div class="card-body">
        <div class="row g-3">
          <div class="col-md-6">
            <label class="form-label small fw-bold text-muted">Nombres y Apellidos</label>
            <input type="text" class="form-control" name="nombre_apellido" required>
          </div>
          <div class="col-md-3">
            <label class="form-label small fw-bold text-muted">Celular</label>
            <input type="tel" class="form-control" name="celular">
          </div>
          <div class="col-md-3">
            <label class="form-label small fw-bold text-muted">Cumpleaños</label>
            <input type="date" class="form-control" name="cumpleanos">
          </div>
          <div class="col-md-6">
            <label class="form-label small fw-bold text-muted">Atención hoy con:</label>
            <select class="form-select" name="atencion_hoy">
              <option value="Estilista A">Estilista A</option>
              <option value="Estilista B">Estilista B</option>
              <option value="Estilista C">Estilista C</option>
            </select>
          </div>
          <div class="col-md-6">
            <label class="form-label small fw-bold text-muted">Servicio Principal</label>
            <select class="form-select" name="servicio_principal">
              <option value="Corte">Corte</option>
              <option value="Color">Color</option>
              <option value="Mechas">Mechas</option>
              <option value="Alisado">Alisado</option>
              <option value="Tratamiento">Tratamiento</option>
            </select>
          </div>
        </div>
      </div>
    </div>

    <div class="card mb-4 shadow-sm border-0">
      <div class="card-header bg-dark text-white font-bold small">DIAGNÓSTICO CAPILAR</div>
      <div class="card-body">
        <div class="mb-4">
          <label class="form-label d-block mb-2 fw-bold text-muted small text-uppercase">Cuero Cabelludo:</label>
          <div id="cont-cuero-cabelludo" class="d-flex flex-wrap gap-2"></div>
        </div>

        <div class="row g-4">
          <div class="col-md-6">
            <label class="form-label fw-bold text-muted small text-uppercase">Densidad:</label>
            <div class="btn-group w-100">
              <input type="radio" class="btn-check" name="densidad" id="d_fino" value="Fino">
              <label class="btn btn-outline-secondary" for="d_fino">Fino</label>
              <input type="radio" class="btn-check" name="densidad" id="d_medio" value="Medio">
              <label class="btn btn-outline-secondary" for="d_medio">Medio</label>
              <input type="radio" class="btn-check" name="densidad" id="d_grueso" value="Grueso">
              <label class="btn btn-outline-secondary" for="d_grueso">Grueso</label>
            </div>
          </div>
          <div class="col-md-6">
            <label class="form-label fw-bold text-muted small text-uppercase">Forma:</label>
            <div class="btn-group w-100">
              <input type="radio" class="btn-check" name="forma" id="f_liso" value="Liso">
              <label class="btn btn-outline-secondary" for="f_liso">Liso</label>
              <input type="radio" class="btn-check" name="forma" id="f_ondulado" value="Ondulado">
              <label class="btn btn-outline-secondary" for="f_ondulado">Ondulado</label>
              <input type="radio" class="btn-check" name="forma" id="f_rizado" value="Rizado">
              <label class="btn btn-outline-secondary" for="f_rizado">Rizado</label>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="card mb-4 shadow-sm border-0 border-start border-warning border-4">
      <div class="card-header bg-orange-600 text-white font-bold small">DIAGNÓSTICO DE COLOR</div>
      <div class="card-body">
        <div class="row g-4 align-items-center">
          <div class="col-md-7">
            <label class="form-label fw-bold text-muted small text-uppercase">Tono de Base (1-10)</label>
            <div id="cont-tonos-base" class="d-flex flex-wrap gap-1"></div>
          </div>
          <div class="col-md-5">
            <label class="form-label fw-bold text-muted d-block text-center small text-uppercase">% de Canas</label>
            <div class="btn-group w-100">
              <input type="radio" class="btn-check" name="canas" id="c0" value="0%">
              <label class="btn btn-outline-danger" for="c0">0%</label>
              <input type="radio" class="btn-check" name="canas" id="c50" value="50%">
              <label class="btn btn-outline-danger" for="c50">50%</label>
              <input type="radio" class="btn-check" name="canas" id="c100" value="100%">
              <label class="btn btn-outline-danger" for="c100">100%</label>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="row g-4 mb-4">
      <div class="col-md-8">
        <div class="card h-100 shadow-sm border-0">
          <div class="card-header bg-light text-dark font-bold small text-uppercase">Observaciones</div>
          <div class="card-body">
            <textarea class="form-control mb-3" name="observaciones" rows="3" placeholder="Resultados..."></textarea>
            <textarea class="form-control" name="recomendaciones" rows="2" placeholder="Productos..."></textarea>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="card h-100 shadow-sm border-0">
          <div class="card-header bg-primary text-white font-bold small text-uppercase text-center">Evidencia</div>
          <div class="card-body text-center">
            <input type="file" class="form-control mb-3" name="foto_diagnostico" id="foto_diagnostico" accept="image/*" capture="camera">
            <div id="preview-foto" class="mt-2 hidden">
               <img src="" id="img-render" class="img-thumbnail" style="max-height: 150px;">
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="d-grid">
      <button type="submit" id="btnGuardarFicha" class="btn btn-primary btn-lg py-3 font-bold shadow-lg">
        GUARDAR FICHA DE DIAGNÓSTICO
      </button>
    </div>
    <div id="feedbackMessage" class="mt-3"></div>
  </form>
</div>

<script>
  // 1. GENERAR BOTONES DINÁMICAMENTE AL CARGAR
  window.addEventListener('load', function() {
    generarBotonesCuero();
    generarBotonesTonos();
  });

  function generarBotonesCuero() {
    const opciones = ['Caspa', 'Normal', 'Caida', 'Graso', 'Seco', 'Sensible', 'Irritaciones'];
    const contenedor = document.getElementById('cont-cuero-cabelludo');
    contenedor.innerHTML = opciones.map((opt, i) => `
      <input type="radio" class="btn-check" name="cuero_cabelludo" id="cc_${i}" value="${opt}">
      <label class="btn btn-outline-primary btn-sm px-3" for="cc_${i}">${opt}</label>
    `).join('');
  }

  function generarBotonesTonos() {
    const contenedor = document.getElementById('cont-tonos-base');
    let html = '';
    for (let i = 1; i <= 10; i++) {
      html += `
        <input type="radio" class="btn-check" name="tono_base" id="tb_${i}" value="${i}">
        <label class="btn btn-outline-dark btn-sm flex-fill" for="tb_${i}">${i}</label>
      `;
    }
    contenedor.innerHTML = html;
  }

  // 2. MANEJO DEL ENVÍO
  document.getElementById('diagnosticoForm').addEventListener('submit', function(e) {
    e.preventDefault();
    const btn = document.getElementById('btnGuardarFicha');
    const feedback = document.getElementById('feedbackMessage');
    
    btn.disabled = true;
    btn.innerText = "PROCESANDO...";

    // Aquí llamarías a tu función de Google Apps Script
    google.script.run
      .withSuccessHandler(res => {
        btn.disabled = false;
        btn.innerText = "GUARDAR FICHA DE DIAGNÓSTICO";
        feedback.innerHTML = '<div class="alert alert-success">✅ Guardado con éxito</div>';
        this.reset();
      })
      .withFailureHandler(err => {
        btn.disabled = false;
        btn.innerText = "GUARDAR FICHA DE DIAGNÓSTICO";
        feedback.innerHTML = '<div class="alert alert-danger">❌ Error: ' + err + '</div>';
      })
      .registrarDiagnostico(this); 
  });
</script>